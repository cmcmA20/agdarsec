<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Text.Parser</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda"><a id="1" class="Keyword">open</a> <a id="6" class="Keyword">import</a> <a id="13" href="Level.html" class="Module">Level</a> <a id="19" class="Keyword">using</a> <a id="25" class="Symbol">(</a><a id="26" href="Agda.Primitive.html#423" class="Postulate">Level</a><a id="31" class="Symbol">)</a>

<a id="34" class="Keyword">module</a> <a id="41" href="Text.Parser.html" class="Module">Text.Parser</a> <a id="53" class="Symbol">(</a><a id="54" href="Text.Parser.html#54" class="Bound">l</a> <a id="56" class="Symbol">:</a> <a id="58" href="Agda.Primitive.html#423" class="Postulate">Level</a><a id="63" class="Symbol">)</a> <a id="65" class="Keyword">where</a>

<a id="72" class="Keyword">open</a> <a id="77" class="Keyword">import</a> <a id="84" href="Category.Monad.html" class="Module">Category.Monad</a>
<a id="99" class="Keyword">open</a> <a id="104" class="Keyword">import</a> <a id="111" href="Data.Char.Base.html" class="Module">Data.Char.Base</a> <a id="126" class="Keyword">using</a> <a id="132" class="Symbol">(</a><a id="133" href="Agda.Builtin.Char.html#227" class="Postulate">Char</a><a id="137" class="Symbol">)</a>
<a id="139" class="Keyword">open</a> <a id="144" class="Keyword">import</a> <a id="151" href="Level.Bounded.html" class="Module">Level.Bounded</a> <a id="165" class="Symbol">as</a> <a id="168" class="Module">Level≤</a> <a id="175" class="Keyword">using</a> <a id="181" class="Symbol">(</a><a id="182" href="Level.Bounded.html#867" class="Record">Set≤</a><a id="186" class="Symbol">;</a> <a id="188" href="Level.Bounded.html#931" class="Field">theSet</a><a id="194" class="Symbol">;</a> <a id="196" href="Level.Bounded.html#1072" class="Function Operator">[_]</a><a id="199" class="Symbol">;</a> <a id="201" href="Level.Bounded.html#3274" class="Function">lift</a><a id="205" class="Symbol">;</a> <a id="207" href="Level.Bounded.html#3495" class="Function">lower</a><a id="212" class="Symbol">)</a>
<a id="214" class="Keyword">open</a> <a id="219" class="Keyword">import</a> <a id="226" href="Relation.Unary.html" class="Module">Relation.Unary</a>

<a id="242" class="Keyword">open</a> <a id="247" class="Keyword">import</a> <a id="254" href="Text.Parser.Types.Core.html" class="Module">Text.Parser.Types.Core</a>
<a id="277" class="Keyword">open</a> <a id="282" class="Keyword">import</a> <a id="289" href="Text.Parser.Monad.html" class="Module">Text.Parser.Monad</a>

<a id="308" class="Comment">-- Our sized text is represented using vectors of characters</a>
<a id="CHARS"></a><a id="369" href="Text.Parser.html#369" class="Function">CHARS</a> <a id="375" class="Symbol">:</a> <a id="377" href="Text.Parser.Types.Core.html#393" class="Record">Parameters</a> <a id="388" href="Text.Parser.html#54" class="Bound">l</a>
<a id="390" href="Text.Parser.html#369" class="Function">CHARS</a> <a id="396" class="Symbol">=</a> <a id="398" href="Text.Parser.Monad.html#4134" class="Function">Agdarsec′.vec</a> <a id="412" href="Level.Bounded.html#1072" class="Function Operator">[</a> <a id="414" href="Agda.Builtin.Char.html#227" class="Postulate">Char</a> <a id="419" href="Level.Bounded.html#1072" class="Function Operator">]</a>

<a id="422" class="Comment">-- We re-export all of the combinators someone may need, specialised to CHARS</a>

<a id="501" class="Keyword">open</a> <a id="506" class="Keyword">import</a> <a id="513" href="Text.Parser.Types.html" class="Module">Text.Parser.Types</a>               <a id="545" href="Text.Parser.html#369" class="Function">CHARS</a> <a id="551" class="Keyword">hiding</a> <a id="558" class="Symbol">(</a>runParser<a id="568" class="Symbol">)</a> <a id="570" class="Keyword">public</a>
<a id="577" class="Keyword">open</a> <a id="582" class="Keyword">import</a> <a id="589" href="Text.Parser.Combinators.html" class="Module">Text.Parser.Combinators</a>         <a id="621" class="Symbol">{</a><a id="622" class="Argument">P</a> <a id="624" class="Symbol">=</a> <a id="626" href="Text.Parser.html#369" class="Function">CHARS</a><a id="631" class="Symbol">}</a> <a id="633" class="Keyword">public</a>
<a id="640" class="Keyword">open</a> <a id="645" class="Keyword">import</a> <a id="652" href="Text.Parser.Combinators.Numbers.html" class="Module">Text.Parser.Combinators.Numbers</a> <a id="684" class="Symbol">{</a><a id="685" class="Argument">P</a> <a id="687" class="Symbol">=</a> <a id="689" href="Text.Parser.html#369" class="Function">CHARS</a><a id="694" class="Symbol">}</a> <a id="696" class="Keyword">public</a>
<a id="703" class="Keyword">open</a> <a id="708" class="Keyword">import</a> <a id="715" href="Text.Parser.Combinators.Char.html" class="Module">Text.Parser.Combinators.Char</a>    <a id="747" class="Symbol">{</a><a id="748" class="Argument">P</a> <a id="750" class="Symbol">=</a> <a id="752" href="Text.Parser.html#369" class="Function">CHARS</a><a id="757" class="Symbol">}</a> <a id="759" class="Keyword">public</a>

<a id="767" class="Comment">-- We export all of the instances that are needed for the combinators to work</a>
<a id="845" class="Comment">-- out of the box</a>

<a id="864" class="Keyword">open</a> <a id="869" class="Keyword">import</a> <a id="876" href="Data.List.Sized.Interface.html" class="Module">Data.List.Sized.Interface</a> <a id="902" class="Keyword">using</a> <a id="908" class="Symbol">(</a><a id="909" href="Data.List.Sized.Interface.html#514" class="Function">vec</a><a id="912" class="Symbol">)</a> <a id="914" class="Keyword">public</a>
<a id="921" class="Keyword">open</a> <a id="926" class="Keyword">import</a> <a id="933" href="Data.Subset.html" class="Module">Data.Subset</a> <a id="945" class="Keyword">using</a> <a id="951" class="Symbol">(</a><a id="952" href="Data.Subset.html#528" class="Function">Subset-refl</a><a id="963" class="Symbol">)</a> <a id="965" class="Keyword">public</a>
<a id="972" class="Keyword">open</a> <a id="977" class="Keyword">import</a> <a id="984" href="Relation.Binary.PropositionalEquality.Decidable.html" class="Module">Relation.Binary.PropositionalEquality.Decidable</a> <a id="1032" class="Keyword">using</a> <a id="1038" class="Symbol">(</a><a id="1039" href="Relation.Binary.PropositionalEquality.Decidable.html#269" class="Function">decide-char</a><a id="1050" class="Symbol">)</a> <a id="1052" class="Keyword">public</a>

<a id="1060" class="Keyword">instance</a>

  <a id="CHARS-monad"></a><a id="1072" href="Text.Parser.html#1072" class="Function">CHARS-monad</a> <a id="1084" class="Symbol">:</a> <a id="1086" href="Category.Monad.html#448" class="Function">RawMonad</a> <a id="1095" class="Symbol">(</a><a id="1096" href="Text.Parser.Monad.html#1218" class="Function">Agdarsec</a> <a id="1105" class="Symbol">{</a><a id="1106" href="Text.Parser.html#54" class="Bound">l</a><a id="1107" class="Symbol">}</a> <a id="1109" href="Level.Bounded.html#1168" class="Function">Level≤.⊤</a> <a id="1118" href="Level.Bounded.html#1231" class="Function">Level≤.⊥</a><a id="1126" class="Symbol">)</a>
  <a id="1130" href="Text.Parser.html#1072" class="Function">CHARS-monad</a>  <a id="1143" class="Symbol">=</a> <a id="1145" href="Text.Parser.Monad.html#3846" class="Function">Agdarsec′.monad</a>

  <a id="CHARS-monad0"></a><a id="1164" href="Text.Parser.html#1164" class="Function">CHARS-monad0</a> <a id="1177" class="Symbol">:</a> <a id="1179" href="Category.Monad.html#643" class="Function">RawMonadZero</a> <a id="1192" class="Symbol">(</a><a id="1193" href="Text.Parser.Monad.html#1218" class="Function">Agdarsec</a> <a id="1202" class="Symbol">{</a><a id="1203" href="Text.Parser.html#54" class="Bound">l</a><a id="1204" class="Symbol">}</a> <a id="1206" href="Level.Bounded.html#1168" class="Function">Level≤.⊤</a> <a id="1215" href="Level.Bounded.html#1231" class="Function">Level≤.⊥</a><a id="1223" class="Symbol">)</a>
  <a id="1227" href="Text.Parser.html#1164" class="Function">CHARS-monad0</a> <a id="1240" class="Symbol">=</a> <a id="1242" href="Text.Parser.Monad.html#1895" class="Function">Agdarsec′.monadZero</a>

  <a id="CHARS-monad+"></a><a id="1265" href="Text.Parser.html#1265" class="Function">CHARS-monad+</a> <a id="1278" class="Symbol">:</a> <a id="1280" href="Category.Monad.html#734" class="Function">RawMonadPlus</a> <a id="1293" class="Symbol">(</a><a id="1294" href="Text.Parser.Monad.html#1218" class="Function">Agdarsec</a> <a id="1303" class="Symbol">{</a><a id="1304" href="Text.Parser.html#54" class="Bound">l</a><a id="1305" class="Symbol">}</a> <a id="1307" href="Level.Bounded.html#1168" class="Function">Level≤.⊤</a> <a id="1316" href="Level.Bounded.html#1231" class="Function">Level≤.⊥</a><a id="1324" class="Symbol">)</a>
  <a id="1328" href="Text.Parser.html#1265" class="Function">CHARS-monad+</a> <a id="1341" class="Symbol">=</a> <a id="1343" href="Text.Parser.Monad.html#2281" class="Function">Agdarsec′.monadPlus</a>

<a id="1364" class="Comment">-- Finally we define a function to run a parser and readily obtain a value</a>

<a id="1440" class="Keyword">open</a> <a id="1445" class="Keyword">import</a> <a id="1452" href="Data.Bool.Base.html" class="Module">Data.Bool.Base</a> <a id="1467" class="Keyword">using</a> <a id="1473" class="Symbol">(</a><a id="1474" href="Data.Bool.Base.html#1283" class="Function Operator">if_then_else_</a><a id="1487" class="Symbol">)</a>
<a id="1489" class="Keyword">open</a> <a id="1494" class="Keyword">import</a> <a id="1501" href="Data.List.Base.html" class="Module">Data.List.Base</a> <a id="1516" class="Keyword">using</a> <a id="1522" class="Symbol">(</a><a id="1523" href="Data.List.Base.html#9981" class="InductiveConstructor">[]</a><a id="1525" class="Symbol">)</a>
<a id="1527" class="Keyword">open</a> <a id="1532" class="Keyword">import</a> <a id="1539" href="Data.Maybe.Base.html" class="Module">Data.Maybe.Base</a> <a id="1555" class="Keyword">using</a> <a id="1561" class="Symbol">(</a><a id="1562" href="Data.Maybe.Base.html#838" class="Datatype">Maybe</a><a id="1567" class="Symbol">;</a> <a id="1569" href="Data.Maybe.Base.html#872" class="InductiveConstructor">nothing</a><a id="1576" class="Symbol">;</a> <a id="1578" href="Data.Maybe.Base.html#892" class="InductiveConstructor">just</a><a id="1582" class="Symbol">)</a>
<a id="1584" class="Keyword">open</a> <a id="1589" class="Keyword">import</a> <a id="1596" href="Data.Nat.Base.html" class="Module">Data.Nat.Base</a> <a id="1610" class="Keyword">using</a> <a id="1616" class="Symbol">(</a><a id="1617" href="Data.Nat.Base.html#1064" class="Primitive Operator">_≡ᵇ_</a><a id="1621" class="Symbol">)</a>
<a id="1623" class="Keyword">import</a> <a id="1630" href="Data.Nat.Properties.html" class="Module">Data.Nat.Properties</a> <a id="1650" class="Symbol">as</a> <a id="1653" class="Module">ℕₚ</a>
<a id="1656" class="Keyword">open</a> <a id="1661" class="Keyword">import</a> <a id="1668" href="Data.Product.html" class="Module">Data.Product</a> <a id="1681" class="Keyword">using</a> <a id="1687" class="Symbol">(</a><a id="1688" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">_,_</a><a id="1691" class="Symbol">)</a>
<a id="1693" class="Keyword">open</a> <a id="1698" class="Keyword">import</a> <a id="1705" href="Data.String.html" class="Module">Data.String</a> <a id="1717" class="Symbol">as</a> <a id="1720" class="Module">String</a> <a id="1727" class="Keyword">using</a> <a id="1733" class="Symbol">(</a><a id="1734" href="Agda.Builtin.String.html#274" class="Postulate">String</a><a id="1740" class="Symbol">)</a>
<a id="1742" class="Keyword">open</a> <a id="1747" class="Keyword">import</a> <a id="1754" href="Function.Base.html" class="Module">Function.Base</a> <a id="1768" class="Keyword">using</a> <a id="1774" class="Symbol">(</a><a id="1775" href="Function.Base.html#4121" class="Function Operator">case_of_</a><a id="1783" class="Symbol">)</a>

<a id="1786" class="Keyword">open</a> <a id="1791" class="Keyword">import</a> <a id="1798" href="Text.Parser.Monad.Result.html" class="Module">Text.Parser.Monad.Result</a> <a id="1823" class="Keyword">using</a> <a id="1829" class="Symbol">(</a><a id="1830" href="Text.Parser.Monad.Result.html#546" class="InductiveConstructor">Value</a><a id="1835" class="Symbol">)</a>
<a id="1837" class="Keyword">open</a> <a id="1842" class="Keyword">import</a> <a id="1849" href="Text.Parser.Position.html" class="Module">Text.Parser.Position</a> <a id="1870" class="Keyword">using</a> <a id="1876" class="Symbol">(</a><a id="1877" href="Text.Parser.Position.html#479" class="Function">start</a><a id="1882" class="Symbol">)</a>

<a id="runParser"></a><a id="1885" href="Text.Parser.html#1885" class="Function">runParser</a> <a id="1895" class="Symbol">:</a> <a id="1897" class="Symbol">{</a><a id="1898" href="Text.Parser.html#1898" class="Bound">A</a> <a id="1900" class="Symbol">:</a> <a id="1902" href="Level.Bounded.html#867" class="Record">Set≤</a> <a id="1907" href="Text.Parser.html#54" class="Bound">l</a><a id="1908" class="Symbol">}</a> <a id="1910" class="Symbol">→</a> <a id="1912" href="Relation.Unary.html#3359" class="Function">∀[</a> <a id="1915" href="Text.Parser.Types.html#564" class="Record">Parser</a> <a id="1922" href="Text.Parser.html#1898" class="Bound">A</a> <a id="1924" href="Relation.Unary.html#3359" class="Function">]</a> <a id="1926" class="Symbol">→</a> <a id="1928" href="Agda.Builtin.String.html#274" class="Postulate">String</a> <a id="1935" class="Symbol">→</a> <a id="1937" href="Data.Maybe.Base.html#838" class="Datatype">Maybe</a> <a id="1943" class="Symbol">(</a><a id="1944" href="Level.Bounded.html#931" class="Field">theSet</a> <a id="1951" href="Text.Parser.html#1898" class="Bound">A</a><a id="1952" class="Symbol">)</a>
<a id="1954" href="Text.Parser.html#1885" class="Function">runParser</a> <a id="1964" href="Text.Parser.html#1964" class="Bound">p</a> <a id="1966" href="Text.Parser.html#1966" class="Bound">str</a> <a id="1970" class="Symbol">=</a>
  <a id="1974" class="Keyword">let</a> <a id="1978" href="Text.Parser.html#1978" class="Bound">init</a>  <a id="1984" class="Symbol">=</a> <a id="1986" href="Level.Bounded.html#3274" class="Function">lift</a> <a id="1991" class="Symbol">(</a><a id="1992" href="Text.Parser.Position.html#479" class="Function">start</a> <a id="1998" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="2000" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a><a id="2002" class="Symbol">)</a>
      <a id="2010" href="Text.Parser.html#2010" class="Bound">input</a> <a id="2016" class="Symbol">=</a> <a id="2018" href="Level.Bounded.html#3274" class="Function">lift</a> <a id="2023" class="Symbol">(</a><a id="2024" href="Data.String.html#699" class="Function">String.toVec</a> <a id="2037" href="Text.Parser.html#1966" class="Bound">str</a><a id="2040" class="Symbol">)</a>
  <a id="2044" class="Keyword">in</a> <a id="2047" href="Function.Base.html#4121" class="Function Operator">case</a> <a id="2052" href="Text.Parser.Types.html#657" class="Field">Parser.runParser</a> <a id="2069" href="Text.Parser.html#1964" class="Bound">p</a> <a id="2071" class="Symbol">(</a><a id="2072" href="Data.Nat.Properties.html#6261" class="Function">ℕₚ.n≤1+n</a> <a id="2081" class="Symbol">_)</a> <a id="2084" href="Text.Parser.html#2010" class="Bound">input</a> <a id="2090" href="Text.Parser.html#1978" class="Bound">init</a> <a id="2095" href="Function.Base.html#4121" class="Function Operator">of</a> <a id="2098" class="Symbol">λ</a> <a id="2100" class="Keyword">where</a>
        <a id="2114" class="Symbol">(</a><a id="2115" href="Text.Parser.Monad.Result.html#546" class="InductiveConstructor">Value</a> <a id="2121" class="Symbol">(</a><a id="2122" href="Text.Parser.html#2122" class="Bound">res</a> <a id="2126" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="2128" class="Symbol">_))</a> <a id="2132" class="Symbol">→</a> <a id="2134" class="Keyword">let</a> <a id="2138" class="Keyword">open</a> <a id="2143" href="Text.Parser.Types.Core.html#942" class="Module">Success</a> <a id="2151" class="Keyword">in</a>
                            <a id="2182" href="Data.Bool.Base.html#1283" class="Function Operator">if</a> <a id="2185" href="Text.Parser.Types.Core.html#1065" class="Field">size</a> <a id="2190" href="Text.Parser.html#2122" class="Bound">res</a> <a id="2194" href="Data.Nat.Base.html#1064" class="Primitive Operator">≡ᵇ</a> <a id="2197" class="Number">0</a>
                            <a id="2227" href="Data.Bool.Base.html#1283" class="Function Operator">then</a> <a id="2232" href="Data.Maybe.Base.html#892" class="InductiveConstructor">just</a> <a id="2237" class="Symbol">(</a><a id="2238" href="Level.Bounded.html#3495" class="Function">lower</a> <a id="2244" class="Symbol">(</a><a id="2245" href="Text.Parser.Types.Core.html#1041" class="Field">value</a> <a id="2251" href="Text.Parser.html#2122" class="Bound">res</a><a id="2254" class="Symbol">))</a>
                            <a id="2285" href="Data.Bool.Base.html#1283" class="Function Operator">else</a> <a id="2290" href="Data.Maybe.Base.html#872" class="InductiveConstructor">nothing</a>
        <a id="2306" class="CatchallClause Symbol">_</a> <a id="2308" class="Symbol">→</a> <a id="2310" href="Data.Maybe.Base.html#872" class="InductiveConstructor">nothing</a>
</pre></body></html>