<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Text.Parser</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda"><a id="1" class="Keyword">open</a> <a id="6" class="Keyword">import</a> <a id="13" href="Level.html" class="Module">Level</a> <a id="19" class="Keyword">using</a> <a id="25" class="Symbol">(</a><a id="26" href="Agda.Primitive.html#423" class="Postulate">Level</a><a id="31" class="Symbol">)</a>

<a id="34" class="Keyword">module</a> <a id="41" href="Text.Parser.html" class="Module">Text.Parser</a> <a id="53" class="Symbol">(</a><a id="54" href="Text.Parser.html#54" class="Bound">l</a> <a id="56" class="Symbol">:</a> <a id="58" href="Agda.Primitive.html#423" class="Postulate">Level</a><a id="63" class="Symbol">)</a> <a id="65" class="Keyword">where</a>

<a id="72" class="Keyword">open</a> <a id="77" class="Keyword">import</a> <a id="84" href="Function.Identity.Categorical.html" class="Module">Function.Identity.Categorical</a> <a id="114" class="Keyword">using</a> <a id="120" class="Symbol">(</a><a id="121" href="Function.Identity.Categorical.html#451" class="Function">Identity</a><a id="129" class="Symbol">)</a>
<a id="131" class="Keyword">open</a> <a id="136" class="Keyword">import</a> <a id="143" href="Category.Monad.html" class="Module">Category.Monad</a>
<a id="158" class="Keyword">open</a> <a id="163" class="Keyword">import</a> <a id="170" href="Data.Char.Base.html" class="Module">Data.Char.Base</a> <a id="185" class="Keyword">using</a> <a id="191" class="Symbol">(</a><a id="192" href="Agda.Builtin.Char.html#227" class="Postulate">Char</a><a id="196" class="Symbol">)</a>
<a id="198" class="Keyword">open</a> <a id="203" class="Keyword">import</a> <a id="210" href="Data.Product.html" class="Module">Data.Product</a> <a id="223" class="Keyword">using</a> <a id="229" class="Symbol">(</a><a id="230" href="Data.Product.html#666" class="Field">proj₁</a><a id="235" class="Symbol">)</a>
<a id="237" class="Keyword">open</a> <a id="242" class="Keyword">import</a> <a id="249" href="Level.Bounded.html" class="Module">Level.Bounded</a> <a id="263" class="Symbol">as</a> <a id="266" class="Module">Level≤</a> <a id="273" class="Keyword">using</a> <a id="279" class="Symbol">(</a><a id="280" href="Level.Bounded.html#867" class="Record">Set≤</a><a id="284" class="Symbol">;</a> <a id="286" href="Level.Bounded.html#931" class="Field">theSet</a><a id="292" class="Symbol">;</a> <a id="294" href="Level.Bounded.html#1072" class="Function Operator">[_]</a><a id="297" class="Symbol">;</a> <a id="299" href="Level.Bounded.html#3274" class="Function">lift</a><a id="303" class="Symbol">;</a> <a id="305" href="Level.Bounded.html#3495" class="Function">lower</a><a id="310" class="Symbol">)</a>
<a id="312" class="Keyword">open</a> <a id="317" class="Keyword">import</a> <a id="324" href="Relation.Unary.html" class="Module">Relation.Unary</a>

<a id="340" class="Keyword">open</a> <a id="345" class="Keyword">import</a> <a id="352" href="Text.Parser.Types.Core.html" class="Module">Text.Parser.Types.Core</a>
<a id="375" class="Keyword">open</a> <a id="380" class="Keyword">import</a> <a id="387" href="Text.Parser.Monad.html" class="Module">Text.Parser.Monad</a>
<a id="405" class="Keyword">open</a> <a id="410" class="Keyword">import</a> <a id="417" href="Text.Parser.Position.html" class="Module">Text.Parser.Position</a> <a id="438" class="Symbol">as</a> <a id="441" class="Module">Position</a> <a id="450" class="Keyword">using</a> <a id="456" class="Symbol">(</a><a id="457" href="Text.Parser.Position.html#380" class="Record">Position</a><a id="465" class="Symbol">;</a> <a id="467" class="Keyword">module</a> <a id="474" href="Text.Parser.Position.html#380" class="Module">Position</a><a id="482" class="Symbol">)</a> <a id="484" class="Keyword">public</a>

<a id="492" class="Keyword">module</a> <a id="CHARS"></a><a id="499" href="Text.Parser.html#499" class="Module">CHARS</a> <a id="505" class="Symbol">=</a> <a id="507" href="Text.Parser.Monad.html#3668" class="Module">Agdarsec</a> <a id="516" href="Text.Parser.html#54" class="Bound">l</a> <a id="518" href="Level.Bounded.html#1072" class="Function Operator">[</a> <a id="520" href="Text.Parser.Position.html#380" class="Record">Position</a> <a id="529" href="Level.Bounded.html#1072" class="Function Operator">]</a> <a id="531" href="Level.Bounded.html#1231" class="Function">Level≤.⊥</a> <a id="540" class="Symbol">(</a><a id="541" class="Keyword">record</a> <a id="548" class="Symbol">{</a> <a id="550" href="Data.Subset.html#173" class="Field">into</a> <a id="555" class="Symbol">=</a> <a id="557" href="Data.Product.html#666" class="Field">proj₁</a> <a id="563" class="Symbol">})</a>

<a id="567" class="Comment">-- Our sized text is represented using vectors of characters</a>

<a id="629" class="Keyword">private</a>
  <a id="ParserM"></a><a id="639" href="Text.Parser.html#639" class="Function">ParserM</a> <a id="647" class="Symbol">:</a> <a id="649" class="PrimitiveType">Set</a> <a id="653" href="Text.Parser.html#54" class="Bound">l</a> <a id="655" class="Symbol">→</a> <a id="657" class="PrimitiveType">Set</a> <a id="661" href="Text.Parser.html#54" class="Bound">l</a>
  <a id="665" href="Text.Parser.html#639" class="Function">ParserM</a> <a id="673" class="Symbol">=</a> <a id="675" href="Text.Parser.Monad.html#991" class="Function">AgdarsecT</a> <a id="685" href="Level.Bounded.html#1072" class="Function Operator">[</a> <a id="687" href="Text.Parser.Position.html#380" class="Record">Position</a> <a id="696" href="Level.Bounded.html#1072" class="Function Operator">]</a> <a id="698" href="Level.Bounded.html#1231" class="Function">Level≤.⊥</a> <a id="707" href="Function.Identity.Categorical.html#451" class="Function">Identity</a>

  <a id="P"></a><a id="719" href="Text.Parser.html#719" class="Function">P</a> <a id="721" class="Symbol">:</a> <a id="723" href="Text.Parser.Types.Core.html#393" class="Record">Parameters</a> <a id="734" href="Text.Parser.html#54" class="Bound">l</a>
  <a id="738" href="Text.Parser.html#719" class="Function">P</a> <a id="740" class="Symbol">=</a> <a id="742" href="Text.Parser.Monad.html#3588" class="Function">CHARS.chars</a>

<a id="755" class="Comment">-- We re-export all of the combinators someone may need, specialised to CHARS</a>

<a id="834" class="Keyword">open</a> <a id="839" class="Keyword">import</a> <a id="846" href="Text.Parser.Types.html" class="Module">Text.Parser.Types</a>               <a id="878" href="Text.Parser.html#719" class="Function">P</a> <a id="880" class="Keyword">hiding</a> <a id="887" class="Symbol">(</a>runParser<a id="897" class="Symbol">)</a> <a id="899" class="Keyword">public</a>
<a id="906" class="Keyword">open</a> <a id="911" class="Keyword">import</a> <a id="918" href="Text.Parser.Combinators.html" class="Module">Text.Parser.Combinators</a>         <a id="950" class="Symbol">{</a><a id="951" class="Argument">P</a> <a id="953" class="Symbol">=</a> <a id="955" href="Text.Parser.html#719" class="Function">P</a><a id="956" class="Symbol">}</a> <a id="958" class="Keyword">public</a>
<a id="965" class="Keyword">open</a> <a id="970" class="Keyword">import</a> <a id="977" href="Text.Parser.Combinators.Numbers.html" class="Module">Text.Parser.Combinators.Numbers</a> <a id="1009" class="Symbol">{</a><a id="1010" class="Argument">P</a> <a id="1012" class="Symbol">=</a> <a id="1014" href="Text.Parser.html#719" class="Function">P</a><a id="1015" class="Symbol">}</a> <a id="1017" class="Keyword">public</a>
<a id="1024" class="Keyword">open</a> <a id="1029" class="Keyword">import</a> <a id="1036" href="Text.Parser.Combinators.Char.html" class="Module">Text.Parser.Combinators.Char</a>    <a id="1068" class="Symbol">{</a><a id="1069" class="Argument">P</a> <a id="1071" class="Symbol">=</a> <a id="1073" href="Text.Parser.html#719" class="Function">P</a><a id="1074" class="Symbol">}</a> <a id="1076" class="Keyword">public</a>

<a id="1084" class="Comment">-- We export all of the instances that are needed for the combinators to work</a>
<a id="1162" class="Comment">-- out of the box</a>

<a id="1181" class="Keyword">open</a> <a id="1186" class="Keyword">import</a> <a id="1193" href="Data.List.Sized.Interface.html" class="Module">Data.List.Sized.Interface</a> <a id="1219" class="Keyword">using</a> <a id="1225" class="Symbol">(</a><a id="1226" href="Data.List.Sized.Interface.html#514" class="Function">vec</a><a id="1229" class="Symbol">)</a> <a id="1231" class="Keyword">public</a>
<a id="1238" class="Keyword">open</a> <a id="1243" class="Keyword">import</a> <a id="1250" href="Data.Subset.html" class="Module">Data.Subset</a> <a id="1262" class="Keyword">using</a> <a id="1268" class="Symbol">(</a><a id="1269" href="Data.Subset.html#528" class="Function">Subset-refl</a><a id="1280" class="Symbol">)</a> <a id="1282" class="Keyword">public</a>
<a id="1289" class="Keyword">open</a> <a id="1294" class="Keyword">import</a> <a id="1301" href="Relation.Binary.PropositionalEquality.Decidable.html" class="Module">Relation.Binary.PropositionalEquality.Decidable</a> <a id="1349" class="Keyword">using</a> <a id="1355" class="Symbol">(</a><a id="1356" href="Relation.Binary.PropositionalEquality.Decidable.html#269" class="Function">decide-char</a><a id="1367" class="Symbol">)</a> <a id="1369" class="Keyword">public</a>

<a id="1377" class="Keyword">instance</a>

  <a id="P-monad"></a><a id="1389" href="Text.Parser.html#1389" class="Function">P-monad</a> <a id="1397" class="Symbol">:</a> <a id="1399" href="Category.Monad.html#448" class="Function">RawMonad</a> <a id="1408" href="Text.Parser.html#639" class="Function">ParserM</a>
  <a id="1418" href="Text.Parser.html#1389" class="Function">P-monad</a>  <a id="1427" class="Symbol">=</a> <a id="1429" href="Text.Parser.Monad.html#3846" class="Function">CHARS.monad</a>

  <a id="P-monad0"></a><a id="1444" href="Text.Parser.html#1444" class="Function">P-monad0</a> <a id="1453" class="Symbol">:</a> <a id="1455" href="Category.Monad.html#643" class="Function">RawMonadZero</a> <a id="1468" href="Text.Parser.html#639" class="Function">ParserM</a>
  <a id="1478" href="Text.Parser.html#1444" class="Function">P-monad0</a> <a id="1487" class="Symbol">=</a> <a id="1489" href="Text.Parser.Monad.html#1895" class="Function">CHARS.monadZero</a>

  <a id="P-monad+"></a><a id="1508" href="Text.Parser.html#1508" class="Function">P-monad+</a> <a id="1517" class="Symbol">:</a> <a id="1519" href="Category.Monad.html#734" class="Function">RawMonadPlus</a> <a id="1532" href="Text.Parser.html#639" class="Function">ParserM</a>
  <a id="1542" href="Text.Parser.html#1508" class="Function">P-monad+</a> <a id="1551" class="Symbol">=</a> <a id="1553" href="Text.Parser.Monad.html#2281" class="Function">CHARS.monadPlus</a>

<a id="1570" class="Comment">-- Finally we define a function to run a parser and readily obtain a value</a>

<a id="1646" class="Keyword">open</a> <a id="1651" class="Keyword">import</a> <a id="1658" href="Data.Bool.Base.html" class="Module">Data.Bool.Base</a> <a id="1673" class="Keyword">using</a> <a id="1679" class="Symbol">(</a><a id="1680" href="Data.Bool.Base.html#1283" class="Function Operator">if_then_else_</a><a id="1693" class="Symbol">)</a>
<a id="1695" class="Keyword">open</a> <a id="1700" class="Keyword">import</a> <a id="1707" href="Data.List.Base.html" class="Module">Data.List.Base</a> <a id="1722" class="Keyword">using</a> <a id="1728" class="Symbol">(</a><a id="1729" href="Data.List.Base.html#9981" class="InductiveConstructor">[]</a><a id="1731" class="Symbol">)</a>
<a id="1733" class="Keyword">open</a> <a id="1738" class="Keyword">import</a> <a id="1745" href="Data.Sum.Base.html" class="Module">Data.Sum.Base</a> <a id="1759" class="Keyword">using</a> <a id="1765" class="Symbol">(</a><a id="1766" href="Data.Sum.Base.html#734" class="Datatype Operator">_⊎_</a><a id="1769" class="Symbol">;</a> <a id="1771" href="Data.Sum.Base.html#784" class="InductiveConstructor">inj₁</a><a id="1775" class="Symbol">;</a> <a id="1777" href="Data.Sum.Base.html#809" class="InductiveConstructor">inj₂</a><a id="1781" class="Symbol">)</a>
<a id="1783" class="Keyword">open</a> <a id="1788" class="Keyword">import</a> <a id="1795" href="Data.Nat.Base.html" class="Module">Data.Nat.Base</a> <a id="1809" class="Keyword">using</a> <a id="1815" class="Symbol">(</a><a id="1816" href="Data.Nat.Base.html#1064" class="Primitive Operator">_≡ᵇ_</a><a id="1820" class="Symbol">)</a>
<a id="1822" class="Keyword">import</a> <a id="1829" href="Data.Nat.Properties.html" class="Module">Data.Nat.Properties</a> <a id="1849" class="Symbol">as</a> <a id="1852" class="Module">ℕₚ</a>
<a id="1855" class="Keyword">open</a> <a id="1860" class="Keyword">import</a> <a id="1867" href="Data.Product.html" class="Module">Data.Product</a> <a id="1880" class="Keyword">using</a> <a id="1886" class="Symbol">(</a><a id="1887" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">_,_</a><a id="1890" class="Symbol">)</a>
<a id="1892" class="Keyword">open</a> <a id="1897" class="Keyword">import</a> <a id="1904" href="Data.String.html" class="Module">Data.String</a> <a id="1916" class="Symbol">as</a> <a id="1919" class="Module">String</a> <a id="1926" class="Keyword">using</a> <a id="1932" class="Symbol">(</a><a id="1933" href="Agda.Builtin.String.html#274" class="Postulate">String</a><a id="1939" class="Symbol">)</a>
<a id="1941" class="Keyword">open</a> <a id="1946" class="Keyword">import</a> <a id="1953" href="Function.Base.html" class="Module">Function.Base</a> <a id="1967" class="Keyword">using</a> <a id="1973" class="Symbol">(</a><a id="1974" href="Function.Base.html#4121" class="Function Operator">case_of_</a><a id="1982" class="Symbol">)</a>

<a id="1985" class="Keyword">import</a> <a id="1992" href="Text.Parser.Monad.Result.html" class="Module">Text.Parser.Monad.Result</a> <a id="2017" class="Symbol">as</a> <a id="2020" class="Module">Result</a>
<a id="2027" class="Keyword">open</a> <a id="2032" class="Keyword">import</a> <a id="2039" href="Text.Parser.Position.html" class="Module">Text.Parser.Position</a> <a id="2060" class="Keyword">using</a> <a id="2066" class="Symbol">(</a><a id="2067" href="Text.Parser.Position.html#479" class="Function">start</a><a id="2072" class="Symbol">)</a>

<a id="runParser"></a><a id="2075" href="Text.Parser.html#2075" class="Function">runParser</a> <a id="2085" class="Symbol">:</a> <a id="2087" class="Symbol">{</a><a id="2088" href="Text.Parser.html#2088" class="Bound">A</a> <a id="2090" class="Symbol">:</a> <a id="2092" href="Level.Bounded.html#867" class="Record">Set≤</a> <a id="2097" href="Text.Parser.html#54" class="Bound">l</a><a id="2098" class="Symbol">}</a> <a id="2100" class="Symbol">→</a> <a id="2102" href="Relation.Unary.html#3359" class="Function">∀[</a> <a id="2105" href="Text.Parser.Types.html#564" class="Record">Parser</a> <a id="2112" href="Text.Parser.html#2088" class="Bound">A</a> <a id="2114" href="Relation.Unary.html#3359" class="Function">]</a> <a id="2116" class="Symbol">→</a> <a id="2118" href="Agda.Builtin.String.html#274" class="Postulate">String</a> <a id="2125" class="Symbol">→</a> <a id="2127" href="Text.Parser.Position.html#380" class="Record">Position</a> <a id="2136" href="Data.Sum.Base.html#734" class="Datatype Operator">⊎</a> <a id="2138" href="Level.Bounded.html#931" class="Field">theSet</a> <a id="2145" href="Text.Parser.html#2088" class="Bound">A</a>
<a id="2147" href="Text.Parser.html#2075" class="Function">runParser</a> <a id="2157" href="Text.Parser.html#2157" class="Bound">p</a> <a id="2159" href="Text.Parser.html#2159" class="Bound">str</a> <a id="2163" class="Symbol">=</a>
  <a id="2167" class="Keyword">let</a> <a id="2171" href="Text.Parser.html#2171" class="Bound">init</a>  <a id="2177" class="Symbol">=</a> <a id="2179" href="Level.Bounded.html#3274" class="Function">lift</a> <a id="2184" class="Symbol">(</a><a id="2185" href="Text.Parser.Position.html#479" class="Function">start</a> <a id="2191" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="2193" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a><a id="2195" class="Symbol">)</a>
      <a id="2203" href="Text.Parser.html#2203" class="Bound">input</a> <a id="2209" class="Symbol">=</a> <a id="2211" href="Level.Bounded.html#3274" class="Function">lift</a> <a id="2216" class="Symbol">(</a><a id="2217" href="Data.String.html#699" class="Function">String.toVec</a> <a id="2230" href="Text.Parser.html#2159" class="Bound">str</a><a id="2233" class="Symbol">)</a>
  <a id="2237" class="Keyword">in</a> <a id="2240" href="Function.Base.html#4121" class="Function Operator">case</a> <a id="2245" href="Text.Parser.Monad.Result.html#736" class="Function">Result.toSum</a> <a id="2258" class="Symbol">(</a><a id="2259" href="Text.Parser.Types.html#657" class="Field">Parser.runParser</a> <a id="2276" href="Text.Parser.html#2157" class="Bound">p</a> <a id="2278" class="Symbol">(</a><a id="2279" href="Data.Nat.Properties.html#6261" class="Function">ℕₚ.n≤1+n</a> <a id="2288" class="Symbol">_)</a> <a id="2291" href="Text.Parser.html#2203" class="Bound">input</a> <a id="2297" href="Text.Parser.html#2171" class="Bound">init</a><a id="2301" class="Symbol">)</a> <a id="2303" href="Function.Base.html#4121" class="Function Operator">of</a> <a id="2306" class="Symbol">λ</a> <a id="2308" class="Keyword">where</a>
        <a id="2322" class="Symbol">(</a><a id="2323" href="Data.Sum.Base.html#809" class="InductiveConstructor">inj₂</a> <a id="2328" class="Symbol">(</a><a id="2329" href="Text.Parser.html#2329" class="Bound">res</a> <a id="2333" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="2335" href="Text.Parser.html#2335" class="Bound">p</a><a id="2336" class="Symbol">))</a> <a id="2339" class="Symbol">→</a> <a id="2341" class="Keyword">let</a> <a id="2345" class="Keyword">open</a> <a id="2350" href="Text.Parser.Types.Core.html#942" class="Module">Success</a> <a id="2358" class="Keyword">in</a>
                           <a id="2388" href="Data.Bool.Base.html#1283" class="Function Operator">if</a> <a id="2391" href="Text.Parser.Types.Core.html#1065" class="Field">size</a> <a id="2396" href="Text.Parser.html#2329" class="Bound">res</a> <a id="2400" href="Data.Nat.Base.html#1064" class="Primitive Operator">≡ᵇ</a> <a id="2403" class="Number">0</a>
                           <a id="2432" href="Data.Bool.Base.html#1283" class="Function Operator">then</a> <a id="2437" href="Data.Sum.Base.html#809" class="InductiveConstructor">inj₂</a> <a id="2442" class="Symbol">(</a><a id="2443" href="Level.Bounded.html#3495" class="Function">lower</a> <a id="2449" class="Symbol">(</a><a id="2450" href="Text.Parser.Types.Core.html#1041" class="Field">value</a> <a id="2456" href="Text.Parser.html#2329" class="Bound">res</a><a id="2459" class="Symbol">))</a>
                           <a id="2489" href="Data.Bool.Base.html#1283" class="Function Operator">else</a> <a id="2494" href="Data.Sum.Base.html#784" class="InductiveConstructor">inj₁</a> <a id="2499" class="Symbol">(</a><a id="2500" href="Data.Product.html#666" class="Field">proj₁</a> <a id="2506" class="Symbol">(</a><a id="2507" href="Level.Bounded.html#3495" class="Function">lower</a> <a id="2513" href="Text.Parser.html#2335" class="Bound">p</a><a id="2514" class="Symbol">))</a>
        <a id="2525" class="Symbol">(</a><a id="2526" href="Data.Sum.Base.html#784" class="InductiveConstructor">inj₁</a> <a id="2531" href="Text.Parser.html#2531" class="Bound">p</a><a id="2532" class="Symbol">)</a> <a id="2534" class="Symbol">→</a> <a id="2536" href="Data.Sum.Base.html#784" class="InductiveConstructor">inj₁</a> <a id="2541" class="Symbol">(</a><a id="2542" href="Level.Bounded.html#3495" class="Function">lower</a> <a id="2548" href="Text.Parser.html#2531" class="Bound">p</a><a id="2549" class="Symbol">)</a>
</pre></body></html>