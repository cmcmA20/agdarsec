<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Text.Parser</title><link rel="stylesheet" href="Agda.css"></head><body><pre class="Agda"><a id="1" class="Keyword">open</a> <a id="6" class="Keyword">import</a> <a id="13" href="Level.html" class="Module">Level</a> <a id="19" class="Keyword">using</a> <a id="25" class="Symbol">(</a><a id="26" href="Agda.Primitive.html#423" class="Postulate">Level</a><a id="31" class="Symbol">)</a>

<a id="34" class="Keyword">module</a> <a id="41" href="Text.Parser.html" class="Module">Text.Parser</a> <a id="53" class="Symbol">(</a><a id="54" href="Text.Parser.html#54" class="Bound">l</a> <a id="56" class="Symbol">:</a> <a id="58" href="Agda.Primitive.html#423" class="Postulate">Level</a><a id="63" class="Symbol">)</a> <a id="65" class="Keyword">where</a>

<a id="72" class="Keyword">open</a> <a id="77" class="Keyword">import</a> <a id="84" href="Category.Monad.html" class="Module">Category.Monad</a>
<a id="99" class="Keyword">open</a> <a id="104" class="Keyword">import</a> <a id="111" href="Data.Char.Base.html" class="Module">Data.Char.Base</a> <a id="126" class="Keyword">using</a> <a id="132" class="Symbol">(</a><a id="133" href="Agda.Builtin.Char.html#227" class="Postulate">Char</a><a id="137" class="Symbol">)</a>
<a id="139" class="Keyword">open</a> <a id="144" class="Keyword">import</a> <a id="151" href="Level.Bounded.html" class="Module">Level.Bounded</a> <a id="165" class="Symbol">as</a> <a id="168" class="Module">Level≤</a> <a id="175" class="Keyword">using</a> <a id="181" class="Symbol">(</a><a id="182" href="Level.Bounded.html#867" class="Record">Set≤</a><a id="186" class="Symbol">;</a> <a id="188" href="Level.Bounded.html#931" class="Field">theSet</a><a id="194" class="Symbol">;</a> <a id="196" href="Level.Bounded.html#1072" class="Function Operator">[_]</a><a id="199" class="Symbol">;</a> <a id="201" href="Level.Bounded.html#3274" class="Function">lift</a><a id="205" class="Symbol">;</a> <a id="207" href="Level.Bounded.html#3495" class="Function">lower</a><a id="212" class="Symbol">)</a>
<a id="214" class="Keyword">open</a> <a id="219" class="Keyword">import</a> <a id="226" href="Relation.Unary.html" class="Module">Relation.Unary</a>

<a id="242" class="Keyword">open</a> <a id="247" class="Keyword">import</a> <a id="254" href="Text.Parser.Types.Core.html" class="Module">Text.Parser.Types.Core</a>
<a id="277" class="Keyword">open</a> <a id="282" class="Keyword">import</a> <a id="289" href="Text.Parser.Monad.html" class="Module">Text.Parser.Monad</a>

<a id="308" class="Comment">-- Our sized text is represented using vectors of characters</a>
<a id="CHARS"></a><a id="369" href="Text.Parser.html#369" class="Function">CHARS</a> <a id="375" class="Symbol">:</a> <a id="377" href="Text.Parser.Types.Core.html#393" class="Record">Parameters</a> <a id="388" href="Text.Parser.html#54" class="Bound">l</a>
<a id="390" href="Text.Parser.html#369" class="Function">CHARS</a> <a id="396" class="Symbol">=</a> <a id="398" href="Text.Parser.Monad.html#4134" class="Function">Agdarsec′.vec</a> <a id="412" href="Level.Bounded.html#1072" class="Function Operator">[</a> <a id="414" href="Agda.Builtin.Char.html#227" class="Postulate">Char</a> <a id="419" href="Level.Bounded.html#1072" class="Function Operator">]</a>

<a id="422" class="Comment">-- We re-export all of the combinators someone may need, specialised to CHARS</a>

<a id="501" class="Keyword">open</a> <a id="506" class="Keyword">import</a> <a id="513" href="Text.Parser.Types.html" class="Module">Text.Parser.Types</a>               <a id="545" href="Text.Parser.html#369" class="Function">CHARS</a> <a id="551" class="Keyword">hiding</a> <a id="558" class="Symbol">(</a>runParser<a id="568" class="Symbol">)</a> <a id="570" class="Keyword">public</a>
<a id="577" class="Keyword">open</a> <a id="582" class="Keyword">import</a> <a id="589" href="Text.Parser.Combinators.html" class="Module">Text.Parser.Combinators</a>         <a id="621" class="Symbol">{</a><a id="622" class="Argument">P</a> <a id="624" class="Symbol">=</a> <a id="626" href="Text.Parser.html#369" class="Function">CHARS</a><a id="631" class="Symbol">}</a> <a id="633" class="Keyword">public</a>
<a id="640" class="Keyword">open</a> <a id="645" class="Keyword">import</a> <a id="652" href="Text.Parser.Combinators.Numbers.html" class="Module">Text.Parser.Combinators.Numbers</a> <a id="684" class="Symbol">{</a><a id="685" class="Argument">P</a> <a id="687" class="Symbol">=</a> <a id="689" href="Text.Parser.html#369" class="Function">CHARS</a><a id="694" class="Symbol">}</a> <a id="696" class="Keyword">public</a>
<a id="703" class="Keyword">open</a> <a id="708" class="Keyword">import</a> <a id="715" href="Text.Parser.Combinators.Char.html" class="Module">Text.Parser.Combinators.Char</a>    <a id="747" class="Symbol">{</a><a id="748" class="Argument">P</a> <a id="750" class="Symbol">=</a> <a id="752" href="Text.Parser.html#369" class="Function">CHARS</a><a id="757" class="Symbol">}</a> <a id="759" class="Keyword">public</a>

<a id="767" class="Comment">-- We export all of the instances that are needed for the combinators to work</a>
<a id="845" class="Comment">-- out of the box</a>

<a id="864" class="Keyword">open</a> <a id="869" class="Keyword">import</a> <a id="876" href="Data.List.Sized.Interface.html" class="Module">Data.List.Sized.Interface</a> <a id="902" class="Keyword">using</a> <a id="908" class="Symbol">(</a><a id="909" href="Data.List.Sized.Interface.html#514" class="Function">vec</a><a id="912" class="Symbol">)</a> <a id="914" class="Keyword">public</a>
<a id="921" class="Keyword">open</a> <a id="926" class="Keyword">import</a> <a id="933" href="Data.Subset.html" class="Module">Data.Subset</a> <a id="945" class="Keyword">using</a> <a id="951" class="Symbol">(</a><a id="952" href="Data.Subset.html#528" class="Function">Subset-refl</a><a id="963" class="Symbol">)</a> <a id="965" class="Keyword">public</a>

<a id="973" class="Keyword">instance</a>

  <a id="CHARS-monad"></a><a id="985" href="Text.Parser.html#985" class="Function">CHARS-monad</a> <a id="997" class="Symbol">:</a> <a id="999" href="Category.Monad.html#448" class="Function">RawMonad</a> <a id="1008" class="Symbol">(</a><a id="1009" href="Text.Parser.Monad.html#1218" class="Function">Agdarsec</a> <a id="1018" class="Symbol">{</a><a id="1019" href="Text.Parser.html#54" class="Bound">l</a><a id="1020" class="Symbol">}</a> <a id="1022" href="Level.Bounded.html#1168" class="Function">Level≤.⊤</a> <a id="1031" href="Level.Bounded.html#1231" class="Function">Level≤.⊥</a><a id="1039" class="Symbol">)</a>
  <a id="1043" href="Text.Parser.html#985" class="Function">CHARS-monad</a>  <a id="1056" class="Symbol">=</a> <a id="1058" href="Text.Parser.Monad.html#3846" class="Function">Agdarsec′.monad</a>

  <a id="CHARS-monad0"></a><a id="1077" href="Text.Parser.html#1077" class="Function">CHARS-monad0</a> <a id="1090" class="Symbol">:</a> <a id="1092" href="Category.Monad.html#643" class="Function">RawMonadZero</a> <a id="1105" class="Symbol">(</a><a id="1106" href="Text.Parser.Monad.html#1218" class="Function">Agdarsec</a> <a id="1115" class="Symbol">{</a><a id="1116" href="Text.Parser.html#54" class="Bound">l</a><a id="1117" class="Symbol">}</a> <a id="1119" href="Level.Bounded.html#1168" class="Function">Level≤.⊤</a> <a id="1128" href="Level.Bounded.html#1231" class="Function">Level≤.⊥</a><a id="1136" class="Symbol">)</a>
  <a id="1140" href="Text.Parser.html#1077" class="Function">CHARS-monad0</a> <a id="1153" class="Symbol">=</a> <a id="1155" href="Text.Parser.Monad.html#1895" class="Function">Agdarsec′.monadZero</a>

  <a id="CHARS-monad+"></a><a id="1178" href="Text.Parser.html#1178" class="Function">CHARS-monad+</a> <a id="1191" class="Symbol">:</a> <a id="1193" href="Category.Monad.html#734" class="Function">RawMonadPlus</a> <a id="1206" class="Symbol">(</a><a id="1207" href="Text.Parser.Monad.html#1218" class="Function">Agdarsec</a> <a id="1216" class="Symbol">{</a><a id="1217" href="Text.Parser.html#54" class="Bound">l</a><a id="1218" class="Symbol">}</a> <a id="1220" href="Level.Bounded.html#1168" class="Function">Level≤.⊤</a> <a id="1229" href="Level.Bounded.html#1231" class="Function">Level≤.⊥</a><a id="1237" class="Symbol">)</a>
  <a id="1241" href="Text.Parser.html#1178" class="Function">CHARS-monad+</a> <a id="1254" class="Symbol">=</a> <a id="1256" href="Text.Parser.Monad.html#2281" class="Function">Agdarsec′.monadPlus</a>

<a id="1277" class="Comment">-- Finally we define a function to run a parser and readily obtain a value</a>

<a id="1353" class="Keyword">open</a> <a id="1358" class="Keyword">import</a> <a id="1365" href="Data.Bool.Base.html" class="Module">Data.Bool.Base</a> <a id="1380" class="Keyword">using</a> <a id="1386" class="Symbol">(</a><a id="1387" href="Data.Bool.Base.html#1283" class="Function Operator">if_then_else_</a><a id="1400" class="Symbol">)</a>
<a id="1402" class="Keyword">open</a> <a id="1407" class="Keyword">import</a> <a id="1414" href="Data.List.Base.html" class="Module">Data.List.Base</a> <a id="1429" class="Keyword">using</a> <a id="1435" class="Symbol">(</a><a id="1436" href="Data.List.Base.html#9981" class="InductiveConstructor">[]</a><a id="1438" class="Symbol">)</a>
<a id="1440" class="Keyword">open</a> <a id="1445" class="Keyword">import</a> <a id="1452" href="Data.Maybe.Base.html" class="Module">Data.Maybe.Base</a> <a id="1468" class="Keyword">using</a> <a id="1474" class="Symbol">(</a><a id="1475" href="Data.Maybe.Base.html#838" class="Datatype">Maybe</a><a id="1480" class="Symbol">;</a> <a id="1482" href="Data.Maybe.Base.html#872" class="InductiveConstructor">nothing</a><a id="1489" class="Symbol">;</a> <a id="1491" href="Data.Maybe.Base.html#892" class="InductiveConstructor">just</a><a id="1495" class="Symbol">)</a>
<a id="1497" class="Keyword">open</a> <a id="1502" class="Keyword">import</a> <a id="1509" href="Data.Nat.Base.html" class="Module">Data.Nat.Base</a> <a id="1523" class="Keyword">using</a> <a id="1529" class="Symbol">(</a><a id="1530" href="Data.Nat.Base.html#1064" class="Primitive Operator">_≡ᵇ_</a><a id="1534" class="Symbol">)</a>
<a id="1536" class="Keyword">import</a> <a id="1543" href="Data.Nat.Properties.html" class="Module">Data.Nat.Properties</a> <a id="1563" class="Symbol">as</a> <a id="1566" class="Module">ℕₚ</a>
<a id="1569" class="Keyword">open</a> <a id="1574" class="Keyword">import</a> <a id="1581" href="Data.Product.html" class="Module">Data.Product</a> <a id="1594" class="Keyword">using</a> <a id="1600" class="Symbol">(</a><a id="1601" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">_,_</a><a id="1604" class="Symbol">)</a>
<a id="1606" class="Keyword">open</a> <a id="1611" class="Keyword">import</a> <a id="1618" href="Data.String.html" class="Module">Data.String</a> <a id="1630" class="Symbol">as</a> <a id="1633" class="Module">String</a> <a id="1640" class="Keyword">using</a> <a id="1646" class="Symbol">(</a><a id="1647" href="Agda.Builtin.String.html#274" class="Postulate">String</a><a id="1653" class="Symbol">)</a>
<a id="1655" class="Keyword">open</a> <a id="1660" class="Keyword">import</a> <a id="1667" href="Function.Base.html" class="Module">Function.Base</a> <a id="1681" class="Keyword">using</a> <a id="1687" class="Symbol">(</a><a id="1688" href="Function.Base.html#4121" class="Function Operator">case_of_</a><a id="1696" class="Symbol">)</a>

<a id="1699" class="Keyword">open</a> <a id="1704" class="Keyword">import</a> <a id="1711" href="Text.Parser.Monad.Result.html" class="Module">Text.Parser.Monad.Result</a> <a id="1736" class="Keyword">using</a> <a id="1742" class="Symbol">(</a><a id="1743" href="Text.Parser.Monad.Result.html#546" class="InductiveConstructor">Value</a><a id="1748" class="Symbol">)</a>
<a id="1750" class="Keyword">open</a> <a id="1755" class="Keyword">import</a> <a id="1762" href="Text.Parser.Position.html" class="Module">Text.Parser.Position</a> <a id="1783" class="Keyword">using</a> <a id="1789" class="Symbol">(</a><a id="1790" href="Text.Parser.Position.html#479" class="Function">start</a><a id="1795" class="Symbol">)</a>

<a id="runParser"></a><a id="1798" href="Text.Parser.html#1798" class="Function">runParser</a> <a id="1808" class="Symbol">:</a> <a id="1810" class="Symbol">{</a><a id="1811" href="Text.Parser.html#1811" class="Bound">A</a> <a id="1813" class="Symbol">:</a> <a id="1815" href="Level.Bounded.html#867" class="Record">Set≤</a> <a id="1820" href="Text.Parser.html#54" class="Bound">l</a><a id="1821" class="Symbol">}</a> <a id="1823" class="Symbol">→</a> <a id="1825" href="Relation.Unary.html#3359" class="Function">∀[</a> <a id="1828" href="Text.Parser.Types.html#564" class="Record">Parser</a> <a id="1835" href="Text.Parser.html#1811" class="Bound">A</a> <a id="1837" href="Relation.Unary.html#3359" class="Function">]</a> <a id="1839" class="Symbol">→</a> <a id="1841" href="Agda.Builtin.String.html#274" class="Postulate">String</a> <a id="1848" class="Symbol">→</a> <a id="1850" href="Data.Maybe.Base.html#838" class="Datatype">Maybe</a> <a id="1856" class="Symbol">(</a><a id="1857" href="Level.Bounded.html#931" class="Field">theSet</a> <a id="1864" href="Text.Parser.html#1811" class="Bound">A</a><a id="1865" class="Symbol">)</a>
<a id="1867" href="Text.Parser.html#1798" class="Function">runParser</a> <a id="1877" href="Text.Parser.html#1877" class="Bound">p</a> <a id="1879" href="Text.Parser.html#1879" class="Bound">str</a> <a id="1883" class="Symbol">=</a>
  <a id="1887" class="Keyword">let</a> <a id="1891" href="Text.Parser.html#1891" class="Bound">init</a>  <a id="1897" class="Symbol">=</a> <a id="1899" href="Level.Bounded.html#3274" class="Function">lift</a> <a id="1904" class="Symbol">(</a><a id="1905" href="Text.Parser.Position.html#479" class="Function">start</a> <a id="1911" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="1913" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a><a id="1915" class="Symbol">)</a>
      <a id="1923" href="Text.Parser.html#1923" class="Bound">input</a> <a id="1929" class="Symbol">=</a> <a id="1931" href="Level.Bounded.html#3274" class="Function">lift</a> <a id="1936" class="Symbol">(</a><a id="1937" href="Data.String.html#699" class="Function">String.toVec</a> <a id="1950" href="Text.Parser.html#1879" class="Bound">str</a><a id="1953" class="Symbol">)</a>
  <a id="1957" class="Keyword">in</a> <a id="1960" href="Function.Base.html#4121" class="Function Operator">case</a> <a id="1965" href="Text.Parser.Types.html#657" class="Field">Parser.runParser</a> <a id="1982" href="Text.Parser.html#1877" class="Bound">p</a> <a id="1984" class="Symbol">(</a><a id="1985" href="Data.Nat.Properties.html#6261" class="Function">ℕₚ.n≤1+n</a> <a id="1994" class="Symbol">_)</a> <a id="1997" href="Text.Parser.html#1923" class="Bound">input</a> <a id="2003" href="Text.Parser.html#1891" class="Bound">init</a> <a id="2008" href="Function.Base.html#4121" class="Function Operator">of</a> <a id="2011" class="Symbol">λ</a> <a id="2013" class="Keyword">where</a>
        <a id="2027" class="Symbol">(</a><a id="2028" href="Text.Parser.Monad.Result.html#546" class="InductiveConstructor">Value</a> <a id="2034" class="Symbol">(</a><a id="2035" href="Text.Parser.html#2035" class="Bound">res</a> <a id="2039" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="2041" class="Symbol">_))</a> <a id="2045" class="Symbol">→</a> <a id="2047" class="Keyword">let</a> <a id="2051" class="Keyword">open</a> <a id="2056" href="Text.Parser.Types.Core.html#942" class="Module">Success</a> <a id="2064" class="Keyword">in</a>
                            <a id="2095" href="Data.Bool.Base.html#1283" class="Function Operator">if</a> <a id="2098" href="Text.Parser.Types.Core.html#1065" class="Field">size</a> <a id="2103" href="Text.Parser.html#2035" class="Bound">res</a> <a id="2107" href="Data.Nat.Base.html#1064" class="Primitive Operator">≡ᵇ</a> <a id="2110" class="Number">0</a>
                            <a id="2140" href="Data.Bool.Base.html#1283" class="Function Operator">then</a> <a id="2145" href="Data.Maybe.Base.html#892" class="InductiveConstructor">just</a> <a id="2150" class="Symbol">(</a><a id="2151" href="Level.Bounded.html#3495" class="Function">lower</a> <a id="2157" class="Symbol">(</a><a id="2158" href="Text.Parser.Types.Core.html#1041" class="Field">value</a> <a id="2164" href="Text.Parser.html#2035" class="Bound">res</a><a id="2167" class="Symbol">))</a>
                            <a id="2198" href="Data.Bool.Base.html#1283" class="Function Operator">else</a> <a id="2203" href="Data.Maybe.Base.html#872" class="InductiveConstructor">nothing</a>
        <a id="2219" class="CatchallClause Symbol">_</a> <a id="2221" class="Symbol">→</a> <a id="2223" href="Data.Maybe.Base.html#872" class="InductiveConstructor">nothing</a>
</pre></body></html>